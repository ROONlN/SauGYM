@{
    ViewData["Title"] = "Antrenör Bul";
}

<div class="container mt-5">
    <div class="text-center">
        <h2 class="mb-3">Antrenör Arama</h2>
        <p class="text-muted">API Bağlantı Durumu: <span id="apiStatus" class="badge bg-secondary">Kontrol ediliyor...</span></p>
    </div>

    <div class="row justify-content-center mb-5">
        <div class="col-md-6">
            <div class="input-group input-group-lg">
                <input type="text" id="txtSearch" class="form-control" placeholder="Uzmanlık alanı (Örn: Teknik, Fitness)...">
                <button class="btn btn-primary" type="button" id="btnSearch">
                    <i class="bi bi-search"></i> Ara
                </button>
            </div>
        </div>
    </div>

    <div class="row" id="trainerList">
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // API Adresini dinamik olarak alıyoruz (Garanti Yöntem)
            // Bu, "/api/TrainersApi" adresinin tam yolunu bulur.
            var baseApiUrl = '@Url.Content("~/api/TrainersApi")';

            // Sayfa açılınca testi başlat
            console.log("Sayfa hazır, API adresi: " + baseApiUrl);
            loadTrainers("");

            $("#btnSearch").click(function () {
                var keyword = $("#txtSearch").val();
                loadTrainers(keyword);
            });

            // Enter tuşu desteği
            $("#txtSearch").keypress(function(e){
                if(e.which == 13) $("#btnSearch").click();
            });

            function loadTrainers(searchQuery) {
                // Filtreleme URL'sini oluştur
                // Eğer arama boşsa hepsini getir, doluysa filtrele
                var requestUrl = baseApiUrl + (searchQuery ? "/Filter?specialization=" + searchQuery : "");

                console.log("İstek atılıyor: " + requestUrl); // F12 Konsolunda bunu göreceksin

                $.ajax({
                    url: requestUrl,
                    type: "GET",
                    success: function (data) {
                        console.log("Veri geldi:", data); // Gelen veriyi konsola bas

                        $("#apiStatus").text("Bağlandı").removeClass("bg-secondary bg-danger").addClass("bg-success");
                        $("#trainerList").empty();

                        if (!data || data.length === 0) {
                            $("#trainerList").html('<div class="col-12 text-center alert alert-warning">Kayıt bulunamadı.</div>');
                            return;
                        }

                        $.each(data, function (index, item) {
                            // API'den gelen verilerin isimleri küçük harfle başlar (fullName, specialization)
                            var html = `
                                <div class="col-md-4 mb-4">
                                    <div class="card h-100 shadow-sm border-0">
                                        <div class="card-body text-center">
                                            <div class="mb-3">
                                                 ${item.imageUrl ? `<img src="${item.imageUrl}" class="rounded-circle" style="width:100px;height:100px;object-fit:cover">` : '<div style="font-size:3rem">💪</div>'}
                                            </div>
                                            <h5 class="card-title text-dark fw-bold">${item.fullName}</h5>
                                            <span class="badge bg-info text-dark mb-2">${item.specialization}</span>
                                            <p class="card-text text-muted small"><i class="bi bi-clock"></i> ${item.workingHours}</p>
                                            <button class="btn btn-outline-primary btn-sm w-100">Randevu Al</button>
                                        </div>
                                    </div>
                                </div>
                            `;
                            $("#trainerList").append(html);
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error("HATA DETAYI:", xhr.responseText);
                        $("#apiStatus").text("Hata Oluştu").removeClass("bg-secondary bg-success").addClass("bg-danger");
                        alert("API'ye ulaşılamadı! Konsola (F12) bakınız.\nHata Kodu: " + xhr.status);
                    }
                });
            }
        });
    </script>
}